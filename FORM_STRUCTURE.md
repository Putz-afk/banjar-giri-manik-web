# Ceremony Form Structure Guide

## Visual Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CeremonyForm                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Header Actions [Back] [Draft/Published] [Save]          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Card: Informasi Dasar                                    â”‚ â”‚
â”‚ â”‚  â€¢ Judul Upacara                                         â”‚ â”‚
â”‚ â”‚  â€¢ Slug (URL)                                            â”‚ â”‚
â”‚ â”‚  â€¢ Jadwal/Waktu                                          â”‚ â”‚
â”‚ â”‚  â€¢ Sarana Banten                                         â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ [+ Tambah Section]                                            â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ  Section 1                                [ğŸ—‘ï¸]         â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚ Title: "Pembukaan" (optional)                      â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚ Langkah 1                                   [ğŸ—‘ï¸]  â”‚   â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ Instruksi: "Ngaturang canang sari..."           â”‚   â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ Mantram: "Om Swastyastu..."                     â”‚   â”‚ â”‚
â”‚ â”‚ â”‚                                                    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ Sub-langkah a                      [ğŸ—‘ï¸] â”‚    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ â€¢ Instruksi: "Ring Padmasana"          â”‚    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ â€¢ Mantram: "..."                       â”‚    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ Sub-langkah b                      [ğŸ—‘ï¸] â”‚    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ â€¢ Instruksi: "Ring Taksu"              â”‚    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â”‚ â€¢ Mantram: "..."                       â”‚    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚ â”‚
â”‚ â”‚ â”‚   [+ Tambah Sub-langkah]                          â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚ â”‚ â”‚ Langkah 2                                   [ğŸ—‘ï¸]  â”‚   â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ Instruksi: "..."                                â”‚   â”‚ â”‚
â”‚ â”‚ â”‚ â€¢ Mantram: "..."                                  â”‚   â”‚ â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚ â”‚                                                           â”‚ â”‚
â”‚ â”‚ [+ Tambah Langkah]                                        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ  Section 2                                [ğŸ—‘ï¸]         â”‚ â”‚
â”‚ â”‚ ...                                                       â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Component Tree

```
CeremonyForm
  â”œâ”€â”€ Form Header
  â”‚   â”œâ”€â”€ Back Button
  â”‚   â””â”€â”€ Action Bar
  â”‚       â”œâ”€â”€ Switch (Draft/Published)
  â”‚       â””â”€â”€ Save Button
  â”‚
  â”œâ”€â”€ Basic Info Card
  â”‚   â”œâ”€â”€ Title Input â†’ Auto-generates Slug
  â”‚   â”œâ”€â”€ Slug Input
  â”‚   â”œâ”€â”€ Schedule Input
  â”‚   â””â”€â”€ Banten Textarea
  â”‚
  â””â”€â”€ Sections List
      â””â”€â”€ Section Card (repeatable)
          â”œâ”€â”€ Section Header
          â”‚   â”œâ”€â”€ Badge (Section N)
          â”‚   â”œâ”€â”€ Title Input
          â”‚   â””â”€â”€ Delete Button
          â”‚
          â””â”€â”€ Items List
              â””â”€â”€ Item Container (repeatable)
                  â”œâ”€â”€ Badge (Langkah N)
                  â”œâ”€â”€ Instruction Input
                  â”œâ”€â”€ Mantra Textarea
                  â”œâ”€â”€ Delete Button
                  â”‚
                  â”œâ”€â”€ Sub-Items List
                  â”‚   â””â”€â”€ Sub-Item Container (repeatable)
                  â”‚       â”œâ”€â”€ Badge (Sub-langkah a, b, c...)
                  â”‚       â”œâ”€â”€ Instruction Input
                  â”‚       â”œâ”€â”€ Mantra Textarea
                  â”‚       â””â”€â”€ Delete Button
                  â”‚
                  â””â”€â”€ Add Sub-Item Button
```

## State Management

### Top-Level State
```typescript
// Basic Fields
- title: string
- slug: string
- schedule: string
- banten: string
- isPublished: boolean

// Nested Structure
- sections: FormSection[]
  â””â”€â”€ tempId: string (client-side tracking)
      id?: string (database ID if editing)
      title: string
      position: number
      items: FormItem[]
        â””â”€â”€ tempId: string
            id?: string
            instruction: string
            mantra: string
            position: number
            subItems: FormSubItem[]
              â””â”€â”€ tempId: string
                  id?: string
                  instruction: string
                  mantra: string
                  position: number
```

## CRUD Operations

### Create Flow
1. User fills form
2. Click "Simpan"
3. Insert ceremony â†’ get ID
4. For each section:
   - Insert section â†’ get ID
   - For each item:
     - Insert item â†’ get ID
     - Bulk insert sub-items
5. Redirect to admin list

### Update Flow
1. Fetch ceremony with nested relations
2. Load into form state
3. User modifies
4. Click "Simpan"
5. Update ceremony
6. Delete all old sections (cascade deletes items & sub-items)
7. Re-insert all sections with new data
8. Redirect to admin list

### Delete Flow (from list)
1. Click delete button
2. Confirm dialog appears
3. User confirms
4. Delete ceremony (cascades automatically due to FK constraints)
5. Page refreshes

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Database   â”‚ Supabase
â”‚              â”‚
â”‚ ceremonies   â”‚â”€â”€â”€â”€â”
â”‚   â”œâ”€sections â”‚    â”‚
â”‚   â”œâ”€items    â”‚    â”‚ Fetch
â”‚   â””â”€sub-itemsâ”‚    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Server  â”‚ Next.js Server Component
              â”‚          â”‚
              â”‚ Fetches  â”‚
              â”‚ & passes â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Client  â”‚ CeremonyForm Component
              â”‚          â”‚
              â”‚ useState â”‚ Manages nested state
              â”‚          â”‚
              â”‚ Updates  â”‚ Add/Remove/Edit operations
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼ Submit
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Server  â”‚ Form submission
              â”‚  Action  â”‚
              â”‚          â”‚
              â”‚  Saves   â”‚ INSERT/UPDATE queries
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ Database â”‚ Data persisted
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Features

### Auto-Slug Generation
- Triggered on title change (create mode only)
- Converts to lowercase, replaces spaces with hyphens
- Example: "Purnama Kadasa" â†’ "purnama-kadasa"

### Position Tracking
- Automatically assigned based on array index
- Ensures proper ordering in display

### Temporary IDs
- Uses `crypto.randomUUID()` for client-side tracking
- Prevents React key conflicts
- Allows add/remove without database round-trips

### Validation
- Title: Required
- Slug: Required
- Item instruction: Required
- Everything else: Optional

### Visual Indicators
- Orange left border for sections
- Numbered badges for steps
- Letter badges (a, b, c...) for sub-steps
- Color-coded action buttons (red for delete)

## Best Practices Applied

1. Single Responsibility: Each component/function has one job
2. Type Safety: Full TypeScript coverage
3. User Feedback: Loading states, error messages
4. Accessibility: Semantic HTML, proper labels
5. Performance: Minimal re-renders, efficient state updates
6. Security: Server-side validation (via Supabase RLS)
7. UX: Clear visual hierarchy, intuitive controls
